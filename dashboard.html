<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel - Controle de Neg√≥cio</title>

    <script>
        (function() {
            const theme = localStorage.getItem('theme');
            if (theme === 'dark') { document.documentElement.classList.add('dark-mode'); }
        })();
    </script>

    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üìà</text></svg>">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- NOVO: Adicionando o CSS da biblioteca Toastify.js -->
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    
    <style>
        /* TODO O SEU CSS ANTERIOR PERMANECE EXATAMENTE O MESMO */
        /* ... */
        :root { /* ...vari√°veis CSS... */
            --cor-primaria: #2c3e50; --cor-secundaria: #3498db; --cor-sucesso: #2ecc71;
            --cor-alerta: #e74c3c; --cor-fundo: #f4f7f9; --cor-texto: #34495e;
            --cor-cartao: #ffffff; --cor-borda: #e0e0e0;
            --sombra-suave: 0 4px 15px rgba(0, 0, 0, 0.05); --borda-radius: 12px;
            --transicao-suave: all 0.3s ease-in-out;
        }
        html.dark-mode {
            --cor-fundo: #161d2a; --cor-cartao: #202b3f; --cor-primaria: #e5e9f0;
            --cor-texto: #bdc3c7; --cor-borda: #3a4a64;
            --sombra-suave: 0 4px 20px rgba(0, 0, 0, 0.25);
        }
        /* ... */

        /* NOVO: Estilos personalizados para o Toast, para combinar com o design */
        .toastify {
            padding: 12px 20px;
            border-radius: var(--borda-radius);
            font-family: 'Poppins', sans-serif;
            font-size: 1rem;
            box-shadow: var(--sombra-suave);
            opacity: 0; /* A biblioteca cuidar√° da anima√ß√£o de fade */
        }
        .toastify.on {
            opacity: 1;
        }
    </style>
</head>
<body>
    <!-- TODO O SEU HTML ANTERIOR PERMANECE EXATAMENTE O MESMO -->
    <div class="container">
        <!-- ... header, main, section.actions, etc ... -->
    </div>
    <div class="modal-overlay" id="modal-overlay">
        <!-- ... modal-content ... -->
    </div>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    
    <!-- NOVO: Adicionando o SCRIPT da biblioteca Toastify.js -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>

<script type="module">
  // Importa√ß√µes do Firebase (sem mudan√ßas)
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
  import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-auth.js";
  import { getFirestore, collection, addDoc, doc, deleteDoc, query, orderBy, onSnapshot } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore.js";

  // Configura√ß√£o e inicializa√ß√£o do Firebase (sem mudan√ßas)
  const firebaseConfig = { /* ...sua config... */ };
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  document.addEventListener('DOMContentLoaded', () => {
    let transactions = [];
    let currentUser = null;

    // L√≥gica do Modo Escuro (sem mudan√ßas)
    // ...

    // Verifica√ß√£o de autentica√ß√£o e logout (sem mudan√ßas)
    // ...

    // Carregamento de transa√ß√µes (sem mudan√ßas)
    // ...

    // NOVO: Fun√ß√£o auxiliar para mostrar notifica√ß√µes Toast
    function showToast(message, type = 'info') {
        const colors = {
            success: 'linear-gradient(to right, #00b09b, #96c93d)',
            error: 'linear-gradient(to right, #ff5f6d, #ffc371)',
            info: 'linear-gradient(to right, #0072ff, #00c6ff)'
        };

        Toastify({
            text: message,
            duration: 3000,
            close: true,
            gravity: "top", // `top` ou `bottom`
            position: "right", // `left`, `center` ou `right`
            stopOnFocus: true, // Impede o fechamento do toast ao passar o mouse
            style: {
                background: colors[type] || colors.info,
            },
        }).showToast();
    }


    const App = {
        updateUI() { /*...*/ },

        addTransaction(e) {
            e.preventDefault();
            const description = document.getElementById('description').value;
            const amount = parseFloat(document.getElementById('amount').value);
            const date = document.getElementById('date').value;
            const type = document.getElementById('transaction-type').value;
            const category = type === 'gasto' ? document.getElementById('category').value : null;

            if (!description || isNaN(amount) || !date || (type === 'gasto' && !category)) {
                showToast("Por favor, preencha todos os campos.", "error"); // NOVO: Toast de erro
                return;
            }

            const newTransaction = { type, description, amount, date, category };
            const transactionsCollection = collection(db, 'users', currentUser.uid, 'transactions');
            
            addDoc(transactionsCollection, newTransaction)
                .then(() => {
                    // NOVO: Toast de sucesso
                    const message = type === 'ganho' ? "Receita adicionada com sucesso!" : "Despesa adicionada com sucesso!";
                    showToast(message, 'success');
                })
                .catch(error => {
                    // NOVO: Toast de erro do Firebase
                    console.error("Erro ao adicionar transa√ß√£o:", error);
                    showToast("Erro ao salvar. Tente novamente.", 'error');
                });
            
            this.Modal.close();
        },

        removeTransaction(id) {
            if (confirm('Tem certeza que deseja excluir este lan√ßamento?')) {
                const transactionDoc = doc(db, 'users', currentUser.uid, 'transactions', id);
                deleteDoc(transactionDoc)
                    .then(() => {
                        // NOVO: Toast de sucesso para exclus√£o
                        showToast("Lan√ßamento exclu√≠do.", 'info');
                    })
                    .catch(error => {
                        // NOVO: Toast de erro do Firebase
                        console.error("Erro ao deletar transa√ß√£o:", error);
                        showToast("Erro ao excluir. Tente novamente.", 'error');
                    });
            }
        },

        // O resto do objeto App permanece o mesmo
        renderTransactions() { /*...*/ },
        updateSummary() { /*...*/ },
        Modal: { /*...*/ },
        handleListClick(e) { /*...*/ },
        formatCurrency: (value) => value.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })
    };
    
    // Listeners de evento permanecem os mesmos
    document.getElementById('add-gasto-btn').addEventListener('click', () => App.Modal.open('gasto'));
    // ...
  });
</script>
</body>
</html>
